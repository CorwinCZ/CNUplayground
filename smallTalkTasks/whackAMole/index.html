<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Whack A Mole!</title>
  <link href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <h1>Whack-a-mole! <span class="score">0</span></h1>
  <button onClick="startGame()">Start!</button>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>

  <div class="game">
    <div class="hole hole1">
      <div class="mole"></div>
    </div>
    <div class="hole hole2">
      <div class="mole"></div>
    </div>
    <div class="hole hole3">
      <div class="mole"></div>
    </div>
    <div class="hole hole4">
      <div class="mole"></div>
    </div>
    <div class="hole hole5">
      <div class="mole"></div>
    </div>
    <div class="hole hole6">
      <div class="mole"></div>
    </div>
  </div>

  <script>
    //query selected dom elements
    const holes = document.querySelectorAll('.hole');
    const scoreBoard = document.querySelector('.score');
    const moles = document.querySelectorAll('.mole');
    const difficulty = document.querySelector('#difficulty');

    // difficulty intervals for the game
    const intervals = {
      "easy": [200, 1000],
      "medium": [150, 750],
      "hard": [100, 500]
    }

    //game variables
    let lastHole;
    let lastMole;
    let selectedDifficulty = difficulty.options[difficulty.selectedIndex].value;
    let gameState = "not-playing";
    let score;

    //random time interval to whack the mole
    const randomTime = (interval) => {
      return Math.floor(Math.random() * (interval[1] - interval[0]) + interval[0]);
    }
    //selects a random hole to popup mole
    const selectHole = (holes) => {
      const index = Math.floor(Math.random() * holes.length);
      const selectedHole = holes[index];
      if (lastHole === selectedHole) {
        return selectHole(holes);
      }
      lastHole = selectedHole;
      return selectedHole;
    }

    //adds necesary css to show a mole from a hole
    const popupMole = () => {
      const limit = randomTime(intervals[selectedDifficulty]);
      const chosenHole = selectHole(holes);
      chosenHole.classList.add('up');
      if (score === 10) {
        gameState = "not-playing";
        changeDifficulty();
      }
      setTimeout(() => {
        chosenHole.classList.remove('up');
        if (gameState === "playing") {
          popupMole();
        }
      }, limit);
    }


    //score handling when whacking a mole, can't click the same mole more times
    const handleMoleClick = (e) => {
      if (lastMole !== e.target) {
        score++;
        scoreBoard.textContent = score;
        lastMole = e.target;
      }
    }

    //changes difficulty only when the player haven't started the game yet
    const changeDifficulty = () => {
      if (gameState === "not-playing") {
        selectedDifficulty = difficulty.options[difficulty.selectedIndex].value;
      }
    }

    //Event listeners
    moles.forEach((mole) => {
      mole.addEventListener('click', handleMoleClick);
    });

    difficulty.addEventListener('change', changeDifficulty);

    const startGame = () => {
      gameState = "playing";
      score = 0;
      popupMole();
    }
  </script>
</body>

</html>